<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.1//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_2.dtd'>
<nta>
	<declaration>int g; // g: tooth wear classification score (between 0 and 4)
const int endage=74; //age until which patients are monitiored
clock age; // the age of a patient
broadcast chan counsel, treatment; // for communication between Patient and Twes
bool b; // presence of  bruxism
bool r; // presence of reflux
bool a; // presence of acidic diet
bool eb; // bruxism treatment enabled
bool er; // reflux treatment enabled
</declaration>
	<template>
		<name>Patient</name>
		<declaration>const int f = 29; // physiological tooth wear per year in micron
const int br = 9; // pathological tooth wear due to bruxism, per year in micron
const int re = 4*f; // pathological tooth wear due to reflux, per year in micron
const int ac = 3*f; // pathological tooth wear due to acid diet, per year in micron
clock w; // amount of tooth wear in micron
clock good; //counts the years not spent in G3 or G4
clock avg; // for calculating the average grade: avg/74 is the average grade in a patient's life
int e; // thickness of enamel (in micron)
int d1; //  1/3 of crown height (in micron)
int d2; // 2/3 of crown height (in micron)
const int elb = 881; // lower bound of interval of possible enamel thickness values
const int clb = 1750; //lower bound of interval of possible 1/3rd of crown height values
const int el = 11; // 100*el is length of interval of possible enamel thickness
const int cl = 3; //100*cl is length of interval of possible 1/3rd of crown height values

</declaration>
		<location id="id0" x="314" y="314">
			<urgent/>
		</location>
		<location id="id1" x="501" y="314">
			<urgent/>
		</location>
		<location id="id2" x="765" y="213">
			<name x="757" y="179">G4</name>
			<label kind="invariant" x="790" y="204">good'==0
&amp;&amp;avg'==4</label>
		</location>
		<location id="id3" x="587" y="213">
			<name x="578" y="179">G3</name>
			<label kind="invariant" x="535" y="229">w'==2*f+b*br+r*re+a*ac
&amp;&amp;avg'==3&amp;&amp;w&lt;=d2&amp;&amp;good'==0</label>
		</location>
		<location id="id4" x="417" y="213">
			<name x="408" y="179">G2</name>
			<label kind="invariant" x="331" y="229">w'==2*f+b*br+r*re+a*ac
&amp;&amp;avg'==2&amp;&amp;w&lt;=d1</label>
		</location>
		<location id="id5" x="238" y="213">
			<name x="230" y="179">G01</name>
			<label kind="invariant" x="136" y="136">w'==f+b*br+r*re+a*ac
&amp;&amp;avg'==1&amp;&amp; w&lt;=e</label>
		</location>
		<location id="id6" x="790" y="314">
			<name x="782" y="280">Start</name>
			<label kind="invariant" x="756" y="331">age&lt;=10&amp;&amp;
avg'==0</label>
		</location>
		<branchpoint id="id7" x="238" y="315">
		</branchpoint>
		<branchpoint id="id8" x="408" y="314">
		</branchpoint>
		<branchpoint id="id9" x="595" y="314">
		</branchpoint>
		<init ref="id6"/>
		<transition>
			<source ref="id7"/>
			<target ref="id5"/>
			<label kind="assignment" x="272" y="263">a=1</label>
			<label kind="probability" x="238" y="280">2</label>
			<nail x="272" y="263"/>
		</transition>
		<transition>
			<source ref="id7"/>
			<target ref="id5"/>
			<label kind="probability" x="195" y="289">8</label>
			<nail x="187" y="272"/>
		</transition>
		<transition>
			<source ref="id0"/>
			<target ref="id7"/>
		</transition>
		<transition>
			<source ref="id8"/>
			<target ref="id0"/>
			<label kind="assignment" x="399" y="272">r=1</label>
			<label kind="probability" x="374" y="297">1</label>
			<nail x="365" y="280"/>
		</transition>
		<transition>
			<source ref="id8"/>
			<target ref="id0"/>
			<label kind="probability" x="382" y="331">9</label>
			<nail x="365" y="348"/>
		</transition>
		<transition>
			<source ref="id1"/>
			<target ref="id8"/>
		</transition>
		<transition>
			<source ref="id9"/>
			<target ref="id1"/>
			<label kind="assignment" x="569" y="272">b=1</label>
			<label kind="probability" x="561" y="297">1</label>
			<nail x="552" y="280"/>
		</transition>
		<transition>
			<source ref="id9"/>
			<target ref="id1"/>
			<label kind="probability" x="578" y="331">9</label>
			<nail x="552" y="348"/>
		</transition>
		<transition>
			<source ref="id3"/>
			<target ref="id2"/>
			<label kind="guard" x="612" y="195">w&gt;=d2</label>
			<label kind="assignment" x="680" y="195">g=4</label>
		</transition>
		<transition>
			<source ref="id4"/>
			<target ref="id3"/>
			<label kind="guard" x="441" y="195">w&gt;=d1</label>
			<label kind="assignment" x="510" y="195">g=3</label>
		</transition>
		<transition>
			<source ref="id5"/>
			<target ref="id4"/>
			<label kind="guard" x="280" y="195">w&gt;=e</label>
			<label kind="assignment" x="340" y="195">g=2</label>
		</transition>
		<transition>
			<source ref="id3"/>
			<target ref="id3"/>
			<label kind="synchronisation" x="552" y="136">counsel?</label>
			<nail x="577" y="204"/>
			<nail x="551" y="153"/>
			<nail x="612" y="153"/>
		</transition>
		<transition>
			<source ref="id4"/>
			<target ref="id4"/>
			<label kind="synchronisation" x="391" y="136">counsel?</label>
			<nail x="382" y="153"/>
			<nail x="442" y="153"/>
		</transition>
		<transition>
			<source ref="id2"/>
			<target ref="id5"/>
			<label kind="synchronisation" x="527" y="42">treatment?</label>
			<label kind="assignment" x="578" y="68">g=1, w=0</label>
			<nail x="757" y="204"/>
			<nail x="476" y="0"/>
		</transition>
		<transition>
			<source ref="id3"/>
			<target ref="id5"/>
			<label kind="synchronisation" x="425" y="85">treatment?</label>
			<label kind="assignment" x="450" y="102">g=1, w=0</label>
			<nail x="570" y="204"/>
			<nail x="425" y="76"/>
		</transition>
		<transition>
			<source ref="id6"/>
			<target ref="id9"/>
			<label kind="select" x="612" y="280">l: int[0,100]</label>
			<label kind="guard" x="705" y="289">age &gt;= 6</label>
			<label kind="assignment" x="646" y="323">g=1,
e= elb+l*el,
d1=clb+l*cl,
d2=2*d1</label>
		</transition>
	</template>
	<template>
		<name>Twes</name>
		<declaration>clock p; // years since the last monitoring session
const int period = 5; // period (in years) of TWES monitoring
int nt = 0; // number of treatments that have taken place
int c = 0; // total costs
const int cmon = 0; // cost of monitoring (in 10s of euro)
const int costa = 0; // cost of acidic diet counseling (in 10s of euro)
const int costb = 21; // cost of bruxism treatment (in 10s of euro)
const int costr = 5; // reflux treatment costs: 10 euro consult plus 40 euro medication
const int ctreat = 400; // cost of restorative treatment (in 10s of euro)
const int ctreatx = 1200; // cost 3rd and 4th restorative treatment (in 10s of euro)
</declaration>
		<location id="id10" x="-127" y="221">
			<urgent/>
		</location>
		<location id="id11" x="-42" y="178">
			<urgent/>
		</location>
		<location id="id12" x="51" y="127">
			<urgent/>
		</location>
		<location id="id13" x="153" y="68">
			<name x="143" y="34">G23</name>
			<urgent/>
		</location>
		<location id="id14" x="-110" y="-178">
			<name x="-120" y="-212">G34</name>
			<urgent/>
		</location>
		<location id="id15" x="-110" y="8">
			<label kind="invariant" x="-144" y="25">p&lt;=period</label>
		</location>
		<location id="id16" x="-314" y="8">
			<name x="-324" y="-26">initial</name>
			<label kind="invariant" x="-348" y="25">age &lt;=15</label>
		</location>
		<branchpoint id="id17" x="-34" y="255">
		</branchpoint>
		<branchpoint id="id18" x="51" y="212">
		</branchpoint>
		<branchpoint id="id19" x="153" y="144">
		</branchpoint>
		<init ref="id16"/>
		<transition>
			<source ref="id11"/>
			<target ref="id17"/>
			<label kind="guard" x="-68" y="195">a==1</label>
			<label kind="assignment" x="-42" y="221">c=c+costa</label>
		</transition>
		<transition>
			<source ref="id12"/>
			<target ref="id18"/>
			<label kind="guard" x="-17" y="153">r==1 and er==1</label>
			<label kind="assignment" x="42" y="170">er=0, c=c+costr</label>
		</transition>
		<transition>
			<source ref="id13"/>
			<target ref="id19"/>
			<label kind="guard" x="136" y="85">b==1 and eb==1</label>
			<label kind="assignment" x="153" y="106">eb=0, c=c+costb</label>
		</transition>
		<transition>
			<source ref="id17"/>
			<target ref="id10"/>
			<label kind="assignment" x="-102" y="263">a=0</label>
			<label kind="probability" x="-59" y="255">1</label>
			<nail x="-93" y="263"/>
		</transition>
		<transition>
			<source ref="id17"/>
			<target ref="id10"/>
			<label kind="probability" x="-59" y="229">9</label>
			<nail x="-42" y="246"/>
			<nail x="-59" y="212"/>
		</transition>
		<transition>
			<source ref="id18"/>
			<target ref="id11"/>
			<label kind="assignment" x="-8" y="195">r=0</label>
			<label kind="probability" x="34" y="212">1</label>
			<nail x="0" y="221"/>
		</transition>
		<transition>
			<source ref="id18"/>
			<target ref="id11"/>
			<label kind="probability" x="25" y="187">1</label>
			<nail x="25" y="178"/>
		</transition>
		<transition>
			<source ref="id19"/>
			<target ref="id12"/>
			<label kind="assignment" x="85" y="136">b=0</label>
			<label kind="probability" x="119" y="136">1</label>
			<nail x="93" y="161"/>
		</transition>
		<transition>
			<source ref="id19"/>
			<target ref="id12"/>
			<label kind="probability" x="127" y="119">1</label>
			<nail x="110" y="119"/>
		</transition>
		<transition>
			<source ref="id10"/>
			<target ref="id15"/>
			<label kind="synchronisation" x="-161" y="76">counsel!</label>
			<nail x="-144" y="110"/>
		</transition>
		<transition>
			<source ref="id11"/>
			<target ref="id10"/>
			<label kind="guard" x="-114" y="165">a==0</label>
			<nail x="-102" y="178"/>
		</transition>
		<transition>
			<source ref="id12"/>
			<target ref="id11"/>
			<label kind="guard" x="-85" y="110">r==0 or er==0</label>
			<nail x="-17" y="127"/>
		</transition>
		<transition>
			<source ref="id13"/>
			<target ref="id12"/>
			<label kind="guard" x="17" y="68">b==0 or eb==0</label>
			<nail x="68" y="76"/>
		</transition>
		<transition>
			<source ref="id15"/>
			<target ref="id13"/>
			<label kind="guard" x="-42" y="17">p&gt;=period and (g==2 or (g==3 and age&lt;50))</label>
			<label kind="assignment" x="-34" y="34">p=0, c=c+cmon</label>
		</transition>
		<transition>
			<source ref="id14"/>
			<target ref="id15"/>
			<label kind="guard" x="-136" y="-153">nt==2 or 
nt ==3</label>
			<label kind="synchronisation" x="-144" y="-110">treatment!</label>
			<label kind="assignment" x="-161" y="-85">nt = nt +1,
c = c + ctreatx,
eb=1, er=1</label>
		</transition>
		<transition>
			<source ref="id16"/>
			<target ref="id15"/>
			<label kind="guard" x="-221" y="-17">age &gt;=11</label>
			<label kind="assignment" x="-272" y="-51">p=0,
eb=1,
er=1</label>
		</transition>
		<transition>
			<source ref="id14"/>
			<target ref="id15"/>
			<label kind="guard" x="-238" y="-153">nt &gt;= 4</label>
			<nail x="-229" y="-85"/>
		</transition>
		<transition>
			<source ref="id15"/>
			<target ref="id15"/>
			<label kind="guard" x="-314" y="51">p&gt;=period and (g&lt;=1)</label>
			<label kind="assignment" x="-255" y="76">p=0,
c = c+cmon</label>
			<nail x="-187" y="85"/>
			<nail x="-280" y="110"/>
			<nail x="-221" y="34"/>
		</transition>
		<transition>
			<source ref="id14"/>
			<target ref="id15"/>
			<label kind="guard" x="-68" y="-144">nt &lt;= 1</label>
			<label kind="synchronisation" x="-51" y="-119">treatment!</label>
			<label kind="assignment" x="-42" y="-85">nt = nt +1,
c = c + ctreat,
eb=1, er=1</label>
			<nail x="17" y="-85"/>
		</transition>
		<transition>
			<source ref="id15"/>
			<target ref="id14"/>
			<label kind="guard" x="68" y="-68">p&gt;=period and 
(g==4 or (g==3 and age &gt;=50))</label>
			<label kind="assignment" x="93" y="-170">p=0,
c = c + cmon</label>
			<nail x="170" y="8"/>
			<nail x="170" y="-178"/>
		</transition>
	</template>
	<template>
		<name>End</name>
		<location id="id20" x="25" y="-59">
		</location>
		<location id="id21" x="-212" y="-59">
			<label kind="invariant" x="-263" y="-42">age&lt;=endage</label>
		</location>
		<init ref="id21"/>
		<transition>
			<source ref="id21"/>
			<target ref="id20"/>
			<label kind="guard" x="-144" y="-85">age &gt;=endage</label>
		</transition>
	</template>
	<system>


system Patient,Twes,End;
 </system>
	<queries>
		<query>
			<formula>E[&lt;=74; 100000] (max:10*Twes.c)
			</formula>
			<comment>
			</comment>
		</query>
		<query>
			<formula>E[&lt;=74; 100000] (max:Twes.nt)
			</formula>
			<comment>
			</comment>
		</query>
		<query>
			<formula>E[&lt;=74; 100000] (max:Patient.avg/74)
			</formula>
			<comment>
			</comment>
		</query>
		<query>
			<formula>E[&lt;=74; 100000] (max:Patient.good)
			</formula>
			<comment>
			</comment>
		</query>
		<query>
			<formula>Pr[&lt;=74](&lt;&gt;Patient.G4)
			</formula>
			<comment>
			</comment>
		</query>
		<query>
			<formula>Pr[&lt;=74] (&lt;&gt; Twes.nt==3)
			</formula>
			<comment>
			</comment>
		</query>
		<query>
			<formula>simulate 1 [&lt;=74] {Patient.w, 10*Twes.c, 1000*g}
			</formula>
			<comment>
			</comment>
		</query>
	</queries>
</nta>
